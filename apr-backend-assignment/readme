# APR Backend Assignment â€” Friend API

A Spring Boot backend service that implements a simple **Friend** system (send/accept/reject/unfriend, lists & mutuals), designed as a coding assignment. The project targets **Java 21** and **Spring Boot 3.5.x** and uses Gradle.

> ğŸ‡°ğŸ‡· **í•œêµ­ì–´ ì•ˆë‚´ëŠ” ì•„ë˜ì— ì´ì–´ì§‘ë‹ˆë‹¤.** (English first, Korean follows.)

---

## Table of Contents

* [Features](#features)
* [Tech Stack](#tech-stack)
* [Project Layout](#project-layout)
* [Getting Started](#getting-started)

  * [Prerequisites](#prerequisites)
  * [Build & Run](#build--run)
  * [Configuration](#configuration)
* [API](#api)

  * [Friend Requests](#friend-requests)
  * [Friendship Management](#friendship-management)
  * [Queries](#queries)
  * [Error Model](#error-model)
* [Rate Limiting (optional)](#rate-limiting-optional)
* [Testing](#testing)
* [Troubleshooting](#troubleshooting)
* [License](#license)

---

## Features

* Send/accept/reject friend requests
* Unfriend
* List my friends, pending requests, and mutual friends
* Basic conflict/error handling (e.g., duplicate request, self request, already friends)
* In-memory (H2) for local dev by default; switchable to PostgreSQL/MySQL via env/profiles

> Note: Endpoint shapes below reflect the intended assignment design. If your implementation differs, adjust this README accordingly.

## Tech Stack

* **Language**: Java 21
* **Framework**: Spring Boot 3.5.x (Spring Web, Validation, [Data JPA if used])
* **Build**: Gradle
* **DB**: H2 (dev) / PostgreSQL or MySQL (prod-ready)
* **Test**: JUnit 5, Spring Boot Test

## Project Layout

```
apr-backend-assignment/
 â”œâ”€ build.gradle
 â”œâ”€ settings.gradle
 â””â”€ src/
    â”œâ”€ main/
    â”‚  â”œâ”€ java/... (domain, repository, service, controller)
    â”‚  â””â”€ resources/
    â”‚     â”œâ”€ application.yml
    â”‚     â””â”€ data.sql (optional seed)
    â””â”€ test/
       â””â”€ java/... (unit/integration tests)
```

## Getting Started

### Prerequisites

* JDK **21**
* Gradle **8.x** (wrapper included)
* (Optional) Docker & a local DB if not using H2

### Build & Run

```bash
# clean build
y ./gradlew clean build

# run (dev profile)
y ./gradlew bootRun
# or
java -jar build/libs/*SNAPSHOT.jar
```

The app starts at `http://localhost:8080`.

### Configuration

Default profile uses **H2**. To use PostgreSQL (example):

```yaml
# src/main/resources/application.yml
spring:
  datasource:
    url: jdbc:h2:mem:frienddb;MODE=PostgreSQL;DB_CLOSE_DELAY=-1
    username: sa
    password:
  jpa:
    hibernate:
      ddl-auto: update
    properties:
      hibernate.format_sql: true

---
spring:
  config:
    activate:
      on-profile: prod
  datasource:
    url: jdbc:postgresql://localhost:5432/frienddb
    username: friend
    password: secret
  jpa:
    hibernate:
      ddl-auto: validate
```

Activate with `--spring.profiles.active=prod`.

Env example:

```bash
SPRING_PROFILES_ACTIVE=prod \
DB_URL=jdbc:postgresql://localhost:5432/frienddb \
DB_USERNAME=friend \
DB_PASSWORD=secret \
java -jar build/libs/*SNAPSHOT.jar
```

## API

**Base URL**: `http://localhost:8080`

### Friend Requests

* **Send request**

  * `POST /api/friends/request`
  * Body:

    ```json
    { "fromUserId": 10, "targetUserId": 1 }
    ```
  * Responses:

    * `201 Created` â€“ created
    * `409 Conflict` â€“ already requested / already friends / self request

* **Accept request**

  * `POST /api/friends/accept`
  * Body:

    ```json
    { "fromUserId": 1, "targetUserId": 10 }
    ```
  * Responses: `200 OK`, `404 Not Found`, `409 Conflict`

* **Reject request**

  * `POST /api/friends/reject`
  * Body:

    ```json
    { "fromUserId": 1, "targetUserId": 10 }
    ```
  * Responses: `200 OK`, `404 Not Found`

### Friendship Management

* **Unfriend**

  * `DELETE /api/friends/remove`
  * Body:

    ```json
    { "userId": 10, "targetUserId": 1 }
    ```
  * Responses: `200 OK`, `404 Not Found`

### Queries

* **My friends**

  * `GET /api/friends/{userId}` â†’ `[ {"id":2,"name":"..."}, ... ]`

* **Pending received requests**

  * `GET /api/friends/{userId}/pending` â†’ list of incoming requests

* **Mutual friends**

  * `GET /api/friends/{userId}/mutual/{otherUserId}` â†’ array of mutuals

> If your implementation exposes search or pagination, document params such as `page`, `size`, `q`.

### Error Model

Typical error response example:

```json
{
  "timestamp": "2025-10-24T12:00:00+09:00",
  "path": "/api/friends/request",
  "status": 409,
  "error": "Conflict",
  "code": "FRIEND_REQUEST_ALREADY_EXISTS",
  "message": "A pending request already exists between the users."
}
```

## Rate Limiting (optional)

You may enable rate limiting with **Bucket4j**. Ensure the correct coordinates exist in `build.gradle` and that **mavenCentral()** is configured:

```gradle
repositories {
    mavenCentral()
}

dependencies {
    implementation("io.github.bucket4j:bucket4j-core:8.10.1")
}
```

If you previously used `com.github.vladimir-bukhtoyarov:bucket4j-core`, switch to `io.github.bucket4j:bucket4j-core`.

## Testing

```bash
y ./gradlew test
```

Add integration tests under `src/test/java`. For controller tests, prefer `@SpringBootTest` or `@WebMvcTest` with mock services.

## Troubleshooting

* **Gradle cannot find Bucket4j**

  * Ensure `mavenCentral()` is present.
  * Use `io.github.bucket4j:bucket4j-core:8.10.1`.
* **409 Conflict on friend request**

  * Likely a duplicate or an existing friendship. Verify current state with the list endpoints.
* **DB connection errors**

  * Check JDBC URL, credentials, and active profile.

## License

This repository is for assignment/demo purposes. If you intend to reuse, please add a license file appropriate for your needs.

---

# í•œêµ­ì–´ ì•ˆë‚´ (Korean)

## ê°œìš”

**Friend** ê¸°ëŠ¥(ìš”ì²­/ìˆ˜ë½/ê±°ì ˆ/ì¹œêµ¬ ëŠê¸°, ëª©ë¡ & ê³µí†µ ì¹œêµ¬ ì¡°íšŒ)ì„ ì œê³µí•˜ëŠ” Spring Boot ë°±ì—”ë“œ ì„œë¹„ìŠ¤ì…ë‹ˆë‹¤. **Java 21**, **Spring Boot 3.5.x**, **Gradle** ê¸°ë°˜ì´ë©°, ë¡œì»¬ ê°œë°œì€ H2(ë©”ëª¨ë¦¬ DB)ë¡œ ë™ì‘í•˜ë„ë¡ ì„¤ê³„í–ˆìŠµë‹ˆë‹¤.

## ì£¼ìš” ê¸°ëŠ¥

* ì¹œêµ¬ ìš”ì²­/ìˆ˜ë½/ê±°ì ˆ
* ì¹œêµ¬ ëŠê¸°
* ë‚´ ì¹œêµ¬/ë³´ë¥˜ ìš”ì²­/ê³µí†µ ì¹œêµ¬ ì¡°íšŒ
* ì¤‘ë³µ ìš”ì²­/ìê¸° ìì‹  ìš”ì²­/ì´ë¯¸ ì¹œêµ¬ì¸ ê²½ìš° ë“±ì˜ ì˜ˆì™¸ ì²˜ë¦¬
* í”„ë¡œí•„ë¡œ H2(ë¡œì»¬) â†” PostgreSQL/MySQL(ìš´ì˜) ì „í™˜ ê°€ëŠ¥

## ê¸°ìˆ  ìŠ¤íƒ

* **ì–¸ì–´**: Java 21
* **í”„ë ˆì„ì›Œí¬**: Spring Boot 3.5.x (Web, Validation, [Data JPA ì‚¬ìš© ì‹œ])
* **ë¹Œë“œ**: Gradle
* **DB**: H2(ê¸°ë³¸) / PostgreSQL ë˜ëŠ” MySQL(ì „í™˜ ê°€ëŠ¥)
* **í…ŒìŠ¤íŠ¸**: JUnit 5, Spring Boot Test

## ì‹œì‘í•˜ê¸°

### ì‚¬ì „ ì¤€ë¹„

* JDK 21, Gradle 8.x (ë˜í¼ í¬í•¨)
* (ì„ íƒ) Docker & ë¡œì»¬ DB

### ë¹Œë“œ/ì‹¤í–‰

```bash
y ./gradlew clean build
y ./gradlew bootRun
# ë˜ëŠ”
java -jar build/libs/*SNAPSHOT.jar
```

ê¸°ë³¸ í¬íŠ¸ëŠ” `8080`ì…ë‹ˆë‹¤.

### ì„¤ì •

ê¸°ë³¸ì€ **H2** ì‚¬ìš©. PostgreSQL ì˜ˆì‹œëŠ” ìœ„ [Configuration](#configuration) ì°¸ê³ . ìš´ì˜ í”„ë¡œí•„ì€ `--spring.profiles.active=prod`ë¡œ í™œì„±í™”í•©ë‹ˆë‹¤.

## API ê°œìš”

* **ìš”ì²­ ë³´ë‚´ê¸°**: `POST /api/friends/request`
* **ìš”ì²­ ìˆ˜ë½**: `POST /api/friends/accept`
* **ìš”ì²­ ê±°ì ˆ**: `POST /api/friends/reject`
* **ì¹œêµ¬ ëŠê¸°**: `DELETE /api/friends/remove`
* **ë‚´ ì¹œêµ¬ ëª©ë¡**: `GET /api/friends/{userId}`
* **ë°›ì€ ë³´ë¥˜ ìš”ì²­**: `GET /api/friends/{userId}/pending`
* **ê³µí†µ ì¹œêµ¬ ì¡°íšŒ**: `GET /api/friends/{userId}/mutual/{otherUserId}`

ìš”ì²­/ì‘ë‹µ ì˜ˆì‹œì™€ ì˜¤ë¥˜ ëª¨ë¸ì€ ì˜ì–´ ì„¹ì…˜ì„ ì°¸ê³ í•˜ì„¸ìš”. ì‹¤ì œ êµ¬í˜„ì´ ë‹¤ë¥¼ ìˆ˜ ìˆìœ¼ë‹ˆ, í”„ë¡œì íŠ¸ì— ë§ì¶° ë³¸ READMEë¥¼ ìˆ˜ì •í•´ ì£¼ì„¸ìš”.

## ì†ë„ ì œí•œ(Bucket4j) ê´€ë ¨

`build.gradle`ì— **mavenCentral()**ê°€ ë“±ë¡ë˜ì–´ ìˆê³ , ì˜ì¡´ì„±ì€ ë‹¤ìŒì„ ê¶Œì¥í•©ë‹ˆë‹¤:

```gradle
implementation("io.github.bucket4j:bucket4j-core:8.10.1")
```

## ìì£¼ ê²ªëŠ” ë¬¸ì œ

* **Bucket4j ì˜ì¡´ì„± í•´ì„ ì‹¤íŒ¨** â†’ ì €ì¥ì†Œ/ì¢Œí‘œ í™•ì¸
* **409 Conflict** â†’ ì¤‘ë³µ ìš”ì²­, ì´ë¯¸ ì¹œêµ¬ ì—¬ë¶€ë¥¼ ì—”ë“œí¬ì¸íŠ¸ë¡œ í™•ì¸
* **DB ì—°ê²° ì‹¤íŒ¨** â†’ í”„ë¡œí•„/URL/ê³„ì • ì •ë³´ í™•ì¸

## ë¼ì´ì„ ìŠ¤

ê³¼ì œ/ë°ëª¨ìš© ì €ì¥ì†Œì…ë‹ˆë‹¤. ì™¸ë¶€ ì¬ì‚¬ìš© ì‹œ ì í•©í•œ ë¼ì´ì„ ìŠ¤ íŒŒì¼ì„ ì¶”ê°€í•´ì£¼ì„¸ìš”.
